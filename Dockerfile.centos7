FROM centos:7

# Switch to vault mirrors (CentOS 7 is EOL)
RUN sed -i 's/mirrorlist/#mirrorlist/g' /etc/yum.repos.d/CentOS-*.repo && \
    sed -i 's|#baseurl=http://mirror.centos.org|baseurl=http://vault.centos.org|g' /etc/yum.repos.d/CentOS-*.repo

# Install SCL and fix its repos too
RUN yum install -y centos-release-scl epel-release

RUN sed -i 's/mirrorlist/#mirrorlist/g' /etc/yum.repos.d/CentOS-SCLo-*.repo 2>/dev/null || true && \
    sed -i 's|# baseurl=http://mirror.centos.org|baseurl=http://vault.centos.org|g' /etc/yum.repos.d/CentOS-SCLo-*.repo 2>/dev/null || true && \
    sed -i 's|#baseurl=http://mirror.centos.org|baseurl=http://vault.centos.org|g' /etc/yum.repos.d/CentOS-SCLo-*.repo 2>/dev/null || true

RUN yum install -y devtoolset-11 git cmake3 python3 \
    libcurl-devel freetype-devel glew-devel libogg-devel opus-devel opusfile-devel \
    libpng-devel SDL2-devel sqlite-devel openssl-devel wavpack-devel zlib-devel curl && \
    yum clean all

RUN curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y
ENV PATH="/root/.cargo/bin:${PATH}"

WORKDIR /build
